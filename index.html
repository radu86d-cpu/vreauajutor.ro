<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>VreauAjutor.ro</title>
  <meta name="description" content="Găsește rapid furnizori locali pentru curățenie, instalatori, electricieni și multe altele. VreauAjutor.ro – servicii în toată România.">

  <!-- (opțional, mic boost LCP) -->
  <link rel="preload" as="image" href="imagini-chatgpt/curatenie.png">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- CSS global + pagina auth separat (dacă îl ai) -->
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="assets/css/auth.css" />

  <!-- AOS -->
  <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">
  <script defer src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => AOS.init());
  </script>
</head>

<body>
  <!-- MODAL autentificare/înregistrare (varianta „OLX-style”) -->
  <div id="authModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="authTitle">
    <div class="modal-content">
      <h2 id="authTitle" class="sr-only">Autentificare sau înregistrare</h2>
      <button type="button" class="close" aria-label="Închide modalul" onclick="inchideModal()">
        <span aria-hidden="true">×</span>
      </button>

      <div class="tab-buttons" role="tablist" aria-label="Formular autentificare">
        <button type="button" id="tab-login" role="tab" aria-controls="loginForm" aria-selected="true" class="active" onclick="schimbaTab('login')">Autentificare</button>
        <button type="button" id="tab-register" role="tab" aria-controls="registerForm" aria-selected="false" onclick="schimbaTab('register')">Înregistrare</button>
      </div>

      <!-- LOGIN -->
      <div id="loginForm" class="tab-content" role="tabpanel" aria-labelledby="tab-login" aria-hidden="false">
        <input type="email" id="login_email" name="email" placeholder="Email" autocomplete="username" required>
        <input type="password" id="login_password" name="password" placeholder="Parolă" autocomplete="current-password" required>
        <button type="button" onclick="autentificare()">Autentificare</button>

        <div class="oauth-row" aria-label="Autentificare rapidă">
          <button type="button" id="fbSignIn" class="oauth-btn" aria-label="Continuă cu Facebook">
            <span class="ico" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M22 12.07C22 6.49 17.52 2 11.93 2S2 6.49 2 12.07C2 17.08 5.66 21.2 10.44 22v-7.04H7.9v-2.89h2.54V9.41c0-2.5 1.49-3.89 3.78-3.89 1.1 0 2.25.2 2.25.2v2.48h-1.27c-1.25 0-1.64.78-1.64 1.57v1.88h2.79l-.45 2.89h-2.34V22C18.34 21.2 22 17.08 22 12.07z"/></svg>
            </span>
            Continuă cu Facebook
          </button>
          <button type="button" id="appleSignIn" class="oauth-btn" aria-label="Continuă cu Apple">
            <span class="ico" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M16.365 1.43c0 1.14-.42 2.1-1.1 2.86-.88.98-2.33 1.74-3.75 1.63-.1-1.13.49-2.32 1.22-3.07.84-.85 2.3-1.48 3.63-1.42zM20.5 17.2c-.68 1.58-1 2.28-1.88 3.68-1.22 1.88-2.94 4.22-5.13 4.24-1.2.01-2.02-.79-3.42-.79-1.42 0-2.28.78-3.48.8-2.17.04-3.84-2.03-5.07-3.9C-.05 18.7-.7 14.6 1.54 11.9c1.05-1.26 2.7-2.08 4.29-2.1 1.34-.03 2.6.86 3.42.86.82 0 2.35-1.07 3.97-.91 1.52.15 2.94.77 3.95 1.86-3.1 1.68-2.62 6.15.33 7.49z"/></svg>
            </span>
            Apple
          </button>
          <button type="button" id="googleSignIn" class="oauth-btn" aria-label="Continuă cu Google">
            <span class="ico" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="none"><path fill="#EA4335" d="M12 10.2v3.9h5.5c-.2 1.3-1.6 3.8-5.5 3.8-3.3 0-6-2.8-6-6.2s2.7-6.2 6-6.2c1.9 0 3.2.8 3.9 1.4l2.7-2.6C16.9 2.6 14.6 1.6 12 1.6 6.9 1.6 2.8 5.7 2.8 10.8s4.1 9.2 9.2 9.2c5.3 0 8.8-3.7 8.8-8.9 0-.6-.1-1-.2-1.4H12z"/></svg>
            </span>
            Google
          </button>
        </div>
      </div>

      <!-- REGISTER -->
      <div id="registerForm" class="tab-content" role="tabpanel" aria-labelledby="tab-register" aria-hidden="true" style="display:none;">
        <input type="email" id="register_email" placeholder="Email" autocomplete="email" required>
        <input type="password" id="register_password" placeholder="Parolă" autocomplete="new-password" required>

        <label class="agree" style="display:flex;align-items:flex-start;gap:8px;margin:8px 0 10px;">
          <input id="agree_terms" type="checkbox" style="margin-top:4px;">
          <span>Sunt de acord cu <a href="/termeni.html" target="_blank" rel="noopener">Termenii și condițiile</a> și <a href="/confidentialitate.html" target="_blank" rel="noopener">Politica de confidențialitate</a>.</span>
        </label>

        <button type="button" onclick="inregistrare()">Creează cont</button>

        <div class="oauth-row" aria-label="Înscriere rapidă">
          <button type="button" id="fbSignUp" class="oauth-btn" aria-label="Continuă cu Facebook">
            <span class="ico" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M22 12.07C22 6.49 17.52 2 11.93 2S2 6.49 2 12.07C2 17.08 5.66 21.2 10.44 22v-7.04H7.9v-2.89h2.54V9.41c0-2.5 1.49-3.89 3.78-3.89 1.1 0 2.25.2 2.25.2v2.48h-1.27c-1.25 0-1.64.78-1.64 1.57v1.88h2.79l-.45 2.89h-2.34V22C18.34 21.2 22 17.08 22 12.07z"/></svg>
            </span>
            Continuă cu Facebook
          </button>
          <button type="button" id="appleSignUp" class="oauth-btn" aria-label="Continuă cu Apple">
            <span class="ico" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M16.365 1.43c0 1.14-.42 2.1-1.1 2.86-.88.98-2.33 1.74-3.75 1.63-.1-1.13.49-2.32 1.22-3.07.84-.85 2.3-1.48 3.63-1.42zM20.5 17.2c-.68 1.58-1 2.28-1.88 3.68-1.22 1.88-2.94 4.22-5.13 4.24-1.2.01-2.02-.79-3.42-.79-1.42 0-2.28.78-3.48.8-2.17.04-3.84-2.03-5.07-3.9C-.05 18.7-.7 14.6 1.54 11.9c1.05-1.26 2.7-2.08 4.29-2.1 1.34-.03 2.6.86 3.42.86.82 0 2.35-1.07 3.97-.91 1.52.15 2.94.77 3.95 1.86-3.1 1.68-2.62 6.15.33 7.49z"/></svg>
            </span>
            Apple
          </button>
          <button type="button" id="googleSignUp" class="oauth-btn" aria-label="Continuă cu Google">
            <span class="ico" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="none"><path fill="#EA4335" d="M12 10.2v3.9h5.5c-.2 1.3-1.6 3.8-5.5 3.8-3.3 0-6-2.8-6-6.2s2.7-6.2 6-6.2c1.9 0 3.2.8 3.9 1.4l2.7-2.6C16.9 2.6 14.6 1.6 12 1.6 6.9 1.6 2.8 5.7 2.8 10.8s4.1 9.2 9.2 9.2c5.3 0 8.8-3.7 8.8-8.9 0-.6-.1-1-.2-1.4H12z"/></svg>
            </span>
            Google
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- HEADER -->
  <header>
    <div class="logo">
      <img src="imagini-chatgpt/logo.png" alt="Vreau Ajutor">
      <h1>VreauAjutor.ro</h1>
    </div>
    <nav>
      <a href="#">Acasă</a>
      <a href="#">Categorii</a>
      <a href="furnizori.html">Furnizori</a>
      <a href="ofera-servicii.html" class="cta-suppliers">Oferă servicii</a>
      <a href="#">Contact</a>
    </nav>
    <div class="auth-buttons">
      <button id="btnLogin" onclick="openLogin()">Autentificare</button>
      <button id="btnRegister" onclick="openRegister()">Înregistrare</button>
      <a href="ofera-servicii.html" class="link-suppliers">Oferă servicii (pentru firme)</a>
    </div>
  </header>

  <!-- HERO SEARCH -->
  <section class="hero-search-band" role="search">
    <form class="hero-search" onsubmit="heroSearch(); return false;">
      <input id="heroQuery" type="search" placeholder="Ex: curățenie Cluj-Napoca" aria-label="Caută servicii sau oraș" enterkeyhint="search">
      <button type="submit">Caută</button>
    </form>
  </section>

  <!-- SLIDER + SELECTOR -->
  <section class="sectiune-slider-selector"
           data-aos="fade-up"
           data-aos-duration="600"
           data-aos-easing="ease-out-cubic">

    <div class="slider-modern">
      <div class="slider-container">
        <div class="slides" id="slides">
          <img src="imagini-chatgpt/curatenie.png" alt="Curățenie" loading="eager" fetchpriority="high" decoding="async">
          <img src="imagini-chatgpt/instal.png" alt="Instalator" loading="lazy" decoding="async">
          <img src="imagini-chatgpt/mecanic.png" alt="Mecanic" loading="lazy" decoding="async">
          <img src="imagini-chatgpt/transport.png" alt="Transport" loading="lazy" decoding="async">
          <img src="imagini-chatgpt/bone.png" alt="Bone" loading="lazy" decoding="async">
          <img src="imagini-chatgpt/electricieni.png" alt="Electricieni" loading="lazy" decoding="async">
        </div>
        <button class="prev" type="button" aria-label="Slide anterior" onclick="moveSlide(-1)">‹</button>
        <button class="next" type="button" aria-label="Slide următor"  onclick="moveSlide(1)">›</button>
      </div>
    </div>

    <div class="selector-zona">
      <h3>Selectează zona și serviciul:</h3>

      <label for="judet">Județ:</label>
      <select id="judet" aria-label="Județ">
        <option value="" selected>Alege județul</option>
      </select>

      <label for="oras">Oraș:</label>
      <select id="oras" aria-label="Oraș">
        <option value="" selected>Alege orașul</option>
      </select>

      <label for="serviciu">Serviciu:</label>
      <select id="serviciu" aria-label="Serviciu">
        <option value="" selected>Alege serviciul</option>
      </select>

      <button
        type="button"
        class="advanced-toggle"
        id="btnAdv"
        aria-expanded="false"
        aria-controls="advanced-panel"
        onclick="toggleAdvanced()">
        Căutare avansată
      </button>

      <div id="advanced-panel" class="advanced-panel" hidden>
        <label for="price_max">Preț maxim (lei)</label>
        <input type="number" id="price_max" min="0" step="1" inputmode="numeric" placeholder="ex: 300">

        <label for="rating_min">Rating minim</label>
        <select id="rating_min">
          <option value="">Indiferent</option>
          <option value="3">3+</option>
          <option value="4">4+</option>
          <option value="4.5">4.5+</option>
        </select>

        <label class="chk">
          <input type="checkbox" id="available_today"> Disponibil azi
        </label>

        <label class="chk">
          <input type="checkbox" id="has_photos"> Numai cu fotografii
        </label>

        <div id="subcat-wrap" class="advanced-panel" style="margin-top:10px;" hidden>
          <div style="display:flex;align-items:center;gap:8px;justify-content:space-between;">
            <strong>Subcategorii</strong>
            <button type="button" id="reset-subcat" class="advanced-toggle" style="width:auto;padding:4px 10px;">Reset</button>
          </div>
          <div id="subcats" style="margin-top:8px;display:flex;flex-wrap:wrap;gap:8px;"></div>
        </div>

        <div id="child-wrap" class="advanced-panel" style="margin-top:10px;" hidden>
          <strong>Sub-subcategorii</strong>
          <div id="children" style="margin-top:8px;display:flex;flex-wrap:wrap;gap:8px;"></div>
        </div>

        <input type="hidden" id="subcat">
        <input type="hidden" id="subsub">
      </div>

      <button type="button" onclick="gotoFurnizori()">Caută</button>
    </div>
  </section>

  <!-- SERVICII POPULARE -->
  <section class="servicii-populare"
           data-aos="fade-up"
           data-aos-delay="120"
           data-aos-duration="600">

    <h2>Servicii Populare</h2>
    <div class="servicii-container">
      <div class="serviciu-box">
        <img src="imagini-chatgpt/curatenie.png" alt="Curățenie" loading="lazy" decoding="async">
        <p>Curățenie locuințe, birouri, spații comerciale</p>
      </div>
      <div class="serviciu-box">
        <img src="imagini-chatgpt/instal.png" alt="Instalator" loading="lazy" decoding="async">
        <p>Reparații instalații sanitare, țevi, robineți</p>
      </div>
      <div class="serviciu-box">
        <img src="imagini-chatgpt/electricieni.png" alt="Electrician" loading="lazy" decoding="async">
        <p>Panouri, prize, iluminat, reparații electrice</p>
      </div>
      <div class="serviciu-box">
        <img src="imagini-chatgpt/bone.png" alt="Bone" loading="lazy" decoding="async">
        <p>Îngrijire copii, dus/adus, supraveghere</p>
      </div>
      <div class="serviciu-box">
        <img src="imagini-chatgpt/electrocasnice.png" alt="Electrocasnice" loading="lazy" decoding="async">
        <p>Reparații electrocasnice, frigidere, mașini de spălat</p>
      </div>
    </div>
  </section>

  <!-- CUM FUNCȚIONEAZĂ -->
  <section class="cum-functioneaza"
           data-aos="fade-up"
           data-aos-delay="200"
           data-aos-duration="600">
    <h2>Cum funcționează</h2>
    <ol>
      <li>Selectezi județul, orașul și serviciul</li>
      <li>Primești lista firmelor disponibile</li>
      <li>Plasezi comanda sau iei legătura direct</li>
    </ol>
  </section>

  <!-- FOOTER -->
  <footer>
    <p>&copy; 2025 VreauAjutor.ro – Toate drepturile rezervate.</p>
  </footer>

  <!-- AjutorBot – widget plutitor -->
  <div id="ajb-widget" class="minimized">
    <div class="ajb-header" role="button" tabindex="0"
         aria-controls="ajb-panel" aria-expanded="false"
         onclick="toggleAjb()" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();toggleAjb();}">
      <span>AjutorBot 🤖</span>
      <span style="margin-left:auto;opacity:.6;font-size:12px;">Click pentru a deschide</span>
    </div>

    <div class="ajb-body" id="ajb-panel">
      <div id="ajb-messages" aria-live="polite" aria-atomic="false"></div>
      <div class="ajb-input">
        <input id="ajb-input" type="text" placeholder="Scrie mesajul tău..." onkeydown="if(event.key==='Enter') ajbSend()" />
        <button onclick="ajbSend()">Trimite</button>
      </div>
    </div>
  </div>

  <!-- Script widget chat -->
  <script>
    const AJB_API = new URLSearchParams(location.search).get('api') || '/chat';
    function toggleAjb(){
      const w = document.getElementById('ajb-widget');
      const header = w.querySelector('.ajb-header');
      w.classList.toggle('minimized');
      const expanded = !w.classList.contains('minimized');
      header.setAttribute('aria-expanded', String(expanded));
      if (expanded) setTimeout(() => document.getElementById('ajb-input').focus(), 0);
    }
    function ajbAppend(sender, text){
      const box = document.getElementById('ajb-messages');
      const d = document.createElement('div');
      d.style.margin = '6px 0';
      d.innerHTML = '<strong>' + sender + ':</strong> ' + (text || '');
      box.appendChild(d);
      box.scrollTop = box.scrollHeight;
    }
    async function ajbSend(){
      const inp = document.getElementById('ajb-input');
      const txt = (inp.value || '').trim();
      if(!txt) return;
      ajbAppend('Tu', txt);
      inp.value = '';
      try{
        const r = await fetch(AJB_API, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message: txt })
        });
        if (!r.ok) throw new Error('Request failed: ' + r.status + ' ' + r.statusText);
        const data = await r.json();
        ajbAppend('AjutorBot', data.reply ?? 'Răspuns gol de la server.');
      }catch(e){
        console.error(e);
        ajbAppend('AjutorBot', 'Nu pot contacta serverul. Verifică dacă rulează pe http://localhost:3000 și dacă ai pus OPENAI_API_KEY.');
      }
    }
  </script>

  <!-- Căutare avansată helpers -->
  <script>
    function toggleAdvanced(){
      const panel = document.getElementById('advanced-panel');
      const btn   = document.getElementById('btnAdv');
      const isHidden = panel.hasAttribute('hidden');
      if (isHidden){
        panel.removeAttribute('hidden');
        btn.setAttribute('aria-expanded','true');
        setTimeout(()=> document.getElementById('price_max')?.focus(), 0);
      } else {
        panel.setAttribute('hidden','');
        btn.setAttribute('aria-expanded','false');
      }
    }
    function gotoFurnizori() {
      const judet    = document.getElementById('judet')?.value || '';
      const oras     = document.getElementById('oras')?.value || '';
      const serviciu = document.getElementById('serviciu')?.value || '';
      const subcat = document.getElementById('subcat')?.value || '';
      const subsub = document.getElementById('subsub')?.value || '';
      const priceMax = document.getElementById('price_max')?.value?.trim() || '';
      const ratingMin= document.getElementById('rating_min')?.value || '';
      const today    = document.getElementById('available_today')?.checked || false;
      const photos   = document.getElementById('has_photos')?.checked || false;

      const params = new URLSearchParams();
      if (judet)    params.set('judet', judet);
      if (oras)     params.set('oras', oras);
      if (serviciu) params.set('service', serviciu);
      if (subcat) params.set('subcat', subcat);
      if (subsub) params.set('subsub', subsub);
      if (priceMax) params.set('pmax', priceMax);
      if (ratingMin)params.set('rmin', ratingMin);
      if (today)    params.set('today', '1');
      if (photos)   params.set('photos', '1');

      window.location.href = 'furnizori.html' + (params.toString() ? '?' + params.toString() : '');
    }
    ['price_max','rating_min'].forEach(id=>{
      document.getElementById(id)?.addEventListener('keydown', e=>{
        if (e.key === 'Enter') { e.preventDefault(); gotoFurnizori(); }
      });
    });
  </script>

  <!-- Enter pe selectoare -->
  <script>
    ['judet','oras','serviciu'].forEach(id=>{
      document.getElementById(id)?.addEventListener('keydown', e=>{
        if (e.key === 'Enter') { e.preventDefault(); gotoFurnizori(); }
      });
    });
  </script>

  <!-- Hero search + selectori dinamici -->
  <script>
    function normalizeRO(s){
      return (s || '')
        .toLowerCase()
        .normalize('NFD')
        .replace(/[\u0300-\u036f]/g,'');
    }
    async function heroSearch(){
      const q = (document.getElementById('heroQuery').value || '').trim();
      if(!q) return;
      try{
        const r = await fetch('/.netlify/functions/lists', { cache:'no-store' });
        const { judete = [] } = await r.json();
        const services = [];
        const nQ = normalizeRO(q);
        const svc = services.find(s => nQ.includes(normalizeRO(s)));
        const jud = judete.find(j => nQ.includes(normalizeRO(j)));
        const params = new URLSearchParams();
        if (svc) params.set('service', svc);
        if (jud) params.set('judet', jud);
        if (!svc && !jud) params.set('service', q);
        location.href = 'furnizori.html' + (params.toString() ? '?' + params.toString() : '');
      }catch(e){
        location.href = 'furnizori.html?service=' + encodeURIComponent(q);
      }
    }
  </script>

  <script>
    const elJudet    = document.getElementById('judet');
    const elOras     = document.getElementById('oras');
    const elCategorie= document.getElementById('serviciu');

    function setOptions(selectEl, items, placeholder) {
      if (!selectEl) return;
      const opts = [`<option value="">${placeholder}</option>`]
        .concat((items || []).map(v => {
          const val = (v.value ?? v).toString();
          const lab = (v.label ?? v).toString();
          return `<option value="${val.replaceAll('"','&quot;')}">${lab}</option>`;
        }));
      selectEl.innerHTML = opts.join('');
    }

    async function loadJudete() {
      try {
        const r = await fetch('/.netlify/functions/lists');
        if (!r.ok) throw new Error(`HTTP ${r.status}`);
        const { judete } = await r.json();
        setOptions(elJudet, (judete || []).map(j => ({ value: j, label: j })), 'Alege județul');
        setOptions(elOras, [], 'Alege orașul');
        setOptions(elCategorie, [], 'Alege serviciul');
      } catch (e) {
        console.error('loadJudete failed', e);
        setOptions(elJudet, [], 'Eroare la încărcarea județelor');
      }
    }

    async function loadOrase(judet) {
      try {
        if (!judet) {
          setOptions(elOras, [], 'Alege orașul');
          setOptions(elCategorie, [], 'Alege serviciul');
          return;
        }
        const r = await fetch(`/.netlify/functions/lists?judet=${encodeURIComponent(judet)}`);
        if (!r.ok) throw new Error(`HTTP ${r.status}`);
        const { orase } = await r.json();
        setOptions(elOras, (orase || []).map(o => ({ value: o, label: o })), 'Alege orașul');
        setOptions(elCategorie, [], 'Alege serviciul');
      } catch (e) {
        console.error('loadOrase failed', e);
        setOptions(elOras, [], 'Eroare la încărcarea orașelor');
      }
    }

    async function loadCategorii(judet, oras) {
      try {
        if (!judet || !oras) {
          setOptions(elCategorie, [], 'Alege serviciul');
          return;
        }
        const r = await fetch(`/.netlify/functions/lists?judet=${encodeURIComponent(judet)}&oras=${encodeURIComponent(oras)}`);
        if (!r.ok) throw new Error(`HTTP ${r.status}`);
        const { names = [] } = await r.json();
        setOptions(elCategorie, (names || []).map(n => ({ value: n, label: n })), 'Alege serviciul');
      } catch (e) {
        console.error('loadCategorii failed', e);
        setOptions(elCategorie, [], 'Eroare la încărcarea serviciilor');
      }
    }

    elJudet?.addEventListener('change', (ev) => {
      const j = ev.target.value || '';
      loadOrase(j);
    });
    elOras?.addEventListener('change', (ev) => {
      const j = elJudet?.value || '';
      const o = ev.target.value || '';
      loadCategorii(j, o);
    });

    document.addEventListener('DOMContentLoaded', loadJudete);
  </script>

  <!-- Supabase + OAuth (init) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script id="auth-init">
    window.supa = null;
    (async () => {
      try {
        const r = await fetch('/.netlify/functions/spa_env', { cache:'no-store' });
        const { SUPABASE_URL, SUPABASE_ANON_KEY } = await r.json();
        window.supa = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        const startOAuth = async (provider) => {
          if (!window.supa) return;
          await window.supa.auth.signInWithOAuth({
            provider,
            options: { redirectTo: window.location.origin + '/auth-callback.html' }
          });
        };

        // OAuth – ambele panouri
        document.getElementById('googleSignIn')?.addEventListener('click', () => startOAuth('google'));
        document.getElementById('fbSignIn')?.addEventListener('click',     () => startOAuth('facebook'));
        document.getElementById('appleSignIn')?.addEventListener('click',  () => startOAuth('apple'));
        document.getElementById('googleSignUp')?.addEventListener('click', () => startOAuth('google'));
        document.getElementById('fbSignUp')?.addEventListener('click',     () => startOAuth('facebook'));
        document.getElementById('appleSignUp')?.addEventListener('click',  () => startOAuth('apple'));

        // Greeting în header
        const { data:{ user } } = await window.supa.auth.getUser();
        if (user) {
          const box = document.querySelector('.auth-buttons');
          if (box) {
            document.getElementById('btnLogin')?.remove();
            document.getElementById('btnRegister')?.remove();
            const hi = document.createElement('div');
            hi.style.fontSize = '13px'; hi.style.opacity = '.9';
            hi.textContent = `Salut, ${user.email}`;
            const out = document.createElement('button');
            out.textContent = 'Ieșire';
            out.style.padding = '6px 10px';
            out.onclick = async () => { await window.supa.auth.signOut(); location.reload(); };
            box.append(hi, out);
          }
        }
      } catch(e) { console.error('ENV load failed', e); }
    })();
  </script>

  <!-- Email/parolă -->
  <script id="auth-email-pass">
    function validPass(p){ return /(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{9,}/.test(p||''); }

    async function inregistrare(){
      const email = document.getElementById('register_email')?.value?.trim();
      const pass  = document.getElementById('register_password')?.value||'';
      const agree = document.getElementById('agree_terms')?.checked;

      if (!window.supa) return alert('Auth indisponibil');
      if (!email) return alert('Completează email-ul.');
      if (!validPass(pass)) return alert('Parola trebuie să aibă minim 9 caractere, cu literă mică, mare și cifră.');
      if (!agree) return alert('Trebuie să accepți Termenii și condițiile.');

      const { error } = await window.supa.auth.signUp({
        email, password: pass,
        options:{ emailRedirectTo: location.origin + '/auth-callback.html' }
      });
      if (error) return alert('Eroare: ' + error.message);
      alert('Cont creat! Verifică email-ul pentru confirmare.');
      document.getElementById('authModal').style.display = 'none';
    }

    async function autentificare(){
      const email = document.getElementById('login_email')?.value?.trim();
      const pass  = document.getElementById('login_password')?.value||'';
      if (!window.supa) return alert('Auth indisponibil');
      if (!email || !pass) return alert('Completează email + parolă');
      const { error } = await window.supa.auth.signInWithPassword({ email, password: pass });
      if (error) return alert('Eroare: ' + error.message);
      alert('Autentificat!');
      document.getElementById('authModal').style.display = 'none';
      location.reload();
    }
  </script>

  <!-- Taxonomy subcategorii/copii + reload categorii după zonă -->
  <script>
    async function ajx(url){ const r = await fetch(url); if(!r.ok) throw new Error(await r.text()); return r.json(); }
    function renderChips(container, items, onClick){
      container.innerHTML = '';
      (items || []).forEach(it => {
        const b = document.createElement('button');
        b.type = 'button';
        b.textContent = it.name + (it.count ? ` (${it.count})` : '');
        b.title = it.name;
        b.style.cssText = 'padding:6px 10px;border:1px solid #ccc;border-radius:999px;background:#fff;cursor:pointer;';
        b.addEventListener('click', () => onClick(it));
        container.appendChild(b);
      });
    }
    async function loadSubcatsForSelectedService() {
      const service = document.getElementById('serviciu')?.value || '';
      const judet   = document.getElementById('judet')?.value || '';
      const oras    = document.getElementById('oras')?.value || '';
      const wrap    = document.getElementById('subcat-wrap');
      const cont    = document.getElementById('subcats');
      const childW  = document.getElementById('child-wrap');
      const hidSub  = document.getElementById('subcat');
      const hidKid  = document.getElementById('subsub');

      hidSub.value = ''; hidKid.value = '';
      childW.hidden = true; document.getElementById('children').innerHTML = '';
      if (!service){ wrap.hidden = true; cont.innerHTML = ''; return; }

      const url = '/.netlify/functions/taxonomy?mode=subcategories'
                + '&service=' + encodeURIComponent(service)
                + (judet ? '&judet='+encodeURIComponent(judet) : '')
                + (oras  ? '&oras=' +encodeURIComponent(oras)  : '');
      try{
        const { subcategories = [] } = await ajx(url);
        if (!subcategories.length){ wrap.hidden = true; cont.innerHTML = ''; return; }
        wrap.hidden = false;
        renderChips(cont, subcategories, (item) => {
          hidSub.value = item.id || item.name;
          hidKid.value = '';
          loadChildrenForSubcat(item.id || item.name);
        });
      }catch(e){
        console.error(e);
        wrap.hidden = true;
      }
    }
    async function loadChildrenForSubcat(subcatId){
      const judet  = document.getElementById('judet')?.value || '';
      const oras   = document.getElementById('oras')?.value || '';
      const wrap   = document.getElementById('child-wrap');
      const cont   = document.getElementById('children');
      const hidKid = document.getElementById('subsub');

      const url = '/.netlify/functions/taxonomy?mode=children&subcat='+encodeURIComponent(subcatId)
                + (judet ? '&judet='+encodeURIComponent(judet) : '')
                + (oras  ? '&oras=' +encodeURIComponent(oras)  : '');
      try{
        const { children = [] } = await ajx(url);
        if (!children.length){ wrap.hidden = true; cont.innerHTML = ''; return; }
        wrap.hidden = false;
        cont.innerHTML = '';
        children.forEach(kid=>{
          const b = document.createElement('button');
          b.type='button';
          b.textContent = kid.name + (kid.count?` (${kid.count})`:``);
          b.style.cssText='padding:6px 10px;border:1px solid #ccc;border-radius:999px;background:#fff;cursor:pointer;';
          b.onclick = () => { hidKid.value = kid.id || kid.name; };
          cont.appendChild(b);
        });
      }catch(e){
        console.error(e);
        wrap.hidden = true;
      }
    }
    const _oldToggleAdvanced = window.toggleAdvanced;
    window.toggleAdvanced = function(){
      _oldToggleAdvanced();
      const panelEl = document.getElementById('advanced-panel');
      const panelNowOpen = panelEl && !panelEl.hasAttribute('hidden');
      if (panelNowOpen) loadSubcatsForSelectedService();
    };
    document.getElementById('serviciu')?.addEventListener('change', loadSubcatsForSelectedService);
    document.getElementById('reset-subcat')?.addEventListener('click', () => {
      document.getElementById('subcat').value = '';
      document.getElementById('subsub').value = '';
      document.getElementById('child-wrap').hidden = true;
      document.getElementById('children').innerHTML = '';
    });
  </script>

  <script>
    async function reloadActiveServicesByArea({ preserveSelection = true } = {}) {
      const judet   = document.getElementById('judet')?.value || '';
      const oras    = document.getElementById('oras')?.value || '';
      const selServ = document.getElementById('serviciu');
      if (!selServ) return;

      const prev = preserveSelection ? selServ.value : '';
      selServ.disabled = true;
      selServ.innerHTML = '<option value="">Se încarcă…</option>';

      try {
        const url = '/.netlify/functions/taxonomy?mode=categories'
                  + (judet ? '&judet=' + encodeURIComponent(judet) : '')
                  + (oras  ? '&oras='  + encodeURIComponent(oras)  : '');
        const { services = [] } = await ajx(url);

        selServ.innerHTML = '<option value="">Alege serviciul</option>';
        services.forEach(s => {
          const val = (typeof s === 'string') ? s : (s.name || '');
          if (!val) return;
          const opt = document.createElement('option');
          opt.value = val;
          opt.textContent = val;
          selServ.appendChild(opt);
        });

        if (prev && [...selServ.options].some(o => o.value === prev)) {
          selServ.value = prev;
        } else {
          selServ.value = '';
          document.getElementById('subcat').value = '';
          document.getElementById('subsub').value = '';
          document.getElementById('subcat-wrap').hidden = true;
          document.getElementById('child-wrap').hidden  = true;
          document.getElementById('subcats').innerHTML  = '';
          document.getElementById('children').innerHTML = '';
        }

        const panelOpen = !document.getElementById('advanced-panel').hasAttribute('hidden');
        if (panelOpen && selServ.value) await loadSubcatsForSelectedService();
      } catch (e) {
        console.error('taxonomy categories error', e);
        selServ.innerHTML = '<option value="">Alege serviciul</option>';
      } finally {
        selServ.disabled = false;
      }
    }
  </script>

  <!-- Slider + modal logic (se bazează pe clasele din style.css) -->
  <script src="script.js" defer></script>
</body>
</html>